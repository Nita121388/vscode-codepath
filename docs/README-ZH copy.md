# Code Path Marker - 可视化代码执行路径标记器

Code Path Marker 是一个 VS Code 扩展，帮助开发者通过交互式节点可视化和标记代码执行路径。支持创建、管理和导航代码流程。便于开发人员在阅读代码时，随时标记关键代码位置和调用关系。

## 示例
节点管理
新建节点
1. 标记为新节点
2. 标记为子节点
3. 标记为父节点
4. 标记为兄弟节点
复制粘贴节点
删除节点、删除节点及其子节点



## 🚀 功能特性

### 交互式代码路径标记
- **右键集成**: 直接从选中代码通过"Code Path"子菜单标记节点
- **自动捕获**: 自动捕获文件路径、行号和代码片段
- **层次关系**: 在执行点之间建立父子关系
- **兄弟节点**: 快速创建与当前节点同级的兄弟节点
- **智能导航**: 使用模糊匹配或精确位置切换节点
- **节点编辑**: 实时编辑节点信息，自动验证和更新预览
- **描述支持**: 为节点添加多行描述
- **文件/文件夹支持**: 从文件资源管理器直接标记文件或文件夹为节点
- **节点操作**: 支持复制、粘贴、剪切、上移、下移等操作

### 智能位置追踪
- **自动检测变化**: 实时检测代码位置变化并提示更新
- **多层搜索策略**: 精确匹配、邻近搜索、全文搜索、模糊匹配
- **用户确认更新**: 点击 OK 后自动更新节点位置、行号和代码片段
- **即时预览刷新**: 更新后预览立即刷新，无需切换节点
- **代码指纹技术**: 使用 SHA-256 哈希确保精确追踪
- **置信度评估**: exact、high、medium、low 四级置信度
- **容错导航**: 即使验证失败也能导航到原始位置

### 树分叉功能
- **多路径追踪**: 为已有父节点的节点添加新父节点时自动创建分叉
- **保留原关系**: 原有父子关系完整保留
- **子孙转移**: 所有子孙节点自动转移到新分支
- **场景探索**: 支持追踪同一代码位置的多条执行路径

### 可视化
- **文本视图**: 清晰的层次树状代码路径表示，简化文件名显示
- **实时更新**: 修改图表时预览自动更新
- **分屏布局**: 代码和预览并排显示，优化工作流程

### Code Path 管理
- **多 Code Path**: 创建和切换不同的代码路径场景
- **自动切换**: 新建图表后自动切换并更新 UI
- **导出/导入**: 通过 json文件与团队成员分享 Code Path
- **导入自动切换**: 导入后自动切换到新图表并导航到当前节点
- **文件浏览器集成**: 右键 `.codepath/*.json` 文件直接预览或分享
- **一键导出**: 预览面板工具栏直接导出当前图表
- **文件分享**: 复制图表文件到剪贴板（Windows/macOS）或路径（Linux）
- **自动保存**: 可配置间隔的工作自动持久化
- **备份恢复**: 内置备份系统防止数据丢失

### 开发者体验
- **状态栏快捷菜单**: 点击状态栏图标快速访问所有 Code Path 管理功能
- **一键操作**: 新建、切换、导出、导入、删除 Code Path，无需记忆命令
- **实时信息**: 一目了然的当前 Code Path 和节点信息
- **命令面板**: 所有操作的完整键盘快捷键支持
- **配置选项**: 自定义默认视图、自动保存和性能设置
- **错误处理**: 优雅的错误恢复和有用的用户消息
- **启动自动加载**: 打开 VS Code 时自动加载上次使用的图表并显示预览
- **预览界面自定义菜单**: 右键预览界面显示自定义操作菜单

## 📋 系统要求

- **VS Code**: 版本 1.74.0 或更高
- **Node.js**: 最新 LTS 版本（用于开发）
- **工作区**: 必须在 VS Code 中打开工作区或文件夹

## 🛠️ 安装

1. 打开 VS Code
2. 转到扩展 (Ctrl+Shift+X)
3. 搜索 "Code Path Marker"
4. 点击安装
5. 提示时重新加载 VS Code

## 🎯 快速开始

### 创建你的第一个代码路径

1. **选择代码**: 在编辑器中高亮任意代码
2. **右键点击**: 从"Code Path"子菜单选择 "Mark as New Node"
3. **查看预览**: Code Path 面板自动打开显示你的节点
4. **添加子节点**: 右键菜单并选择 "Mark as Child Node" 来建立关系
5. **添加父节点**: 右键菜单并选择 "Mark as Parent Node" 来建立关系
6. **添加兄弟节点**: 右键菜单并选择 "Mark as Bro Node" 来创建同级节点
7. **导航**: 点击预览上对应的节点自动切换当前节点并导航到对应代码位置
8. **编辑节点**: 点击节点后选择 "Edit Node" 修改信息
9. **位置追踪**: 代码移动后，点击"🔄Refresh",系统自动提示更新位置
10. **节点操作**: 在预览界面右键节点使用复制、粘贴、剪切、上移、下移功能

### 使用状态栏快捷菜单

Code Path Marker 在 VS Code 左下角状态栏提供了一个便捷的快捷菜单：

1. **点击状态栏**: 点击显示 `$(graph) Code Path 名称 (节点数)` 的状态栏项
2. **选择操作**: 从弹出菜单中选择你需要的操作：
   - 🆕 **新建 Code Path** - 创建一个新的 Code Path（自动切换）
   - 🔄 **切换 Code Path** - 在不同 Code Path 之间快速切换
   - 📤 **导出 Code Path** - 将当前 Code Path 导出为 Markdown 文件
   - 📥 **导入 Code Path** - 从 Markdown 文件导入 Code Path（自动切换和导航）
   - 🗑️ **删除 Code Path** - 删除不需要的 Code Path
   - 🔄 **刷新预览** - 手动刷新预览面板
   - 🔄 **切换节点** - 快速切换到不同节点
   - 📝 **标记节点** - 标记新节点、子节点、父节点或兄弟节点

这是最快捷的 Code Path 管理方式，无需记忆任何命令或快捷键！

### 使用文件浏览器功能

在文件浏览器中管理 Code Path 文件：

1. **预览图表**: 右键 `.codepath/*.json` 文件 → "Code Path" → "预览 Code Path"
   - 自动切换到该图表并打开预览
2. **分享图表**: 右键 `.codepath/*.json` 文件 → "Code Path" → "分享 Code Path"
   - Windows/macOS: 文件复制到剪贴板，可直接粘贴到聊天工具
   - Linux: 文件路径复制到剪贴板
3. **从文件/文件夹创建节点**: 右键任意文件或文件夹 → "Code Path" → 选择标记类型
   - 自动使用文件/文件夹名称作为节点名称
   - 自动设置正确的文件路径

### 基本工作流程

```
选择代码 → 右键点击 → 新建节点 → 建立关系 → 导航和可视化 → 编辑和追踪
```

**节点类型选择**:
- **根节点**: 创建新的执行路径起点
- **子节点**: 在当前节点下创建下级节点
- **父节点**: 在当前节点上创建上级节点（可能创建分叉）
- **兄弟节点**: 创建与当前节点同级的平行节点### 键盘快捷键

| 操作 | 快捷键 | 描述 |
|------|--------|------|
| 打开面板 | `Ctrl+Shift+C` | 显示/隐藏 Code Path 预览面板 |
| 标记为新节点 | `Ctrl+Alt+N` | 从选择标记新的根节点 |
| 标记为子节点 | `Ctrl+Alt+C` | 在当前节点下标记子节点（可能创建分叉） |
| 标记为父节点 | `Ctrl+Alt+P` | 在当前节点上标记父节点（可能创建分叉） |
| 标记为兄弟节点 | `Ctrl+Alt+B` | 标记与当前节点同级的兄弟节点 |
| 切换节点 | `Ctrl+Alt+S` | 切换到不同节点（支持模糊搜索） |
| 切换 Code Path | `Ctrl+Shift+G` | 在 Code Path 间切换 |
| 切换格式 | `Ctrl+Shift+T` | 在文本和图表视图间切换 |
| 刷新 | `Ctrl+Shift+R` | 刷新预览（重新验证所有节点） |

**提示**: 大多数操作也可以通过点击状态栏 Code Path 图标快速访问！

### 命令面板完整命令列表

通过 `Ctrl+Shift+P` 打开命令面板，可以使用以下 Code Path Marker 命令：

| 命令 | 描述 |
|------|------|
| `Code Path Marker: Mark as New Node` | 标记新的根节点 |
| `Code Path Marker: Mark as Child Node` | 标记子节点 |
| `Code Path Marker: Mark as Parent Node` | 标记父节点 |
| `Code Path Marker: Mark as Bro Node` | 标记兄弟节点 |
| `Code Path Marker: Copy Node` | 复制节点及其子节点 |
| `Code Path Marker: Paste Node` | 粘贴节点 |
| `Code Path Marker: Cut Node` | 剪切节点及其子节点 |
| `Code Path Marker: Move Node Up` | 上移节点 |
| `Code Path Marker: Move Node Down` | 下移节点 |
| `Code Path Marker: Switch Current Node` | 切换当前节点 |
| `Code Path Marker: Create New Code Path` | 创建新的 Code Path |
| `Code Path Marker: Switch Code Path` | 切换 Code Path |
| `Code Path Marker: Export Code Path` | 导出 Code Path |
| `Code Path Marker: Import Code Path` | 导入 Code Path |
| `Code Path Marker: Delete Code Path` | 删除 Code Path |
| `Code Path Marker: Show Preview` | 显示预览面板 |
| `Code Path Marker: Toggle View Format` | 切换预览格式 |
| `Code Path Marker: Refresh Preview` | 刷新预览 |

## ⚙️ 配置

Code Path Marker 可以通过 VS Code 设置进行自定义：

### 可用设置

```json
{
  "codepath.defaultView": "text",              // 默认预览格式: "text" 或 "mermaid"
  "codepath.autoSave": true,                   // 启用自动图表保存
  "codepath.autoLoadLastGraph": true,          // 启动时加载上次使用的图表
  "codepath.previewRefreshInterval": 1000,     // 预览更新间隔 (毫秒)
  "codepath.maxNodesPerGraph": 100             // 每个图表的最大节点数
}
```

### 访问设置

1. 打开 VS Code 设置 (`Ctrl+,`)
2. 搜索 "Code Path Marker"
3. 根据需要修改设置

## 📖 使用指南

### 创建节点

#### 根节点
1. 在任意文件中选择代码文本
2. 右键点击并选择 "New Node"
3. 如果不存在图表会自动创建新图表

#### 子节点
1. 确保已选择当前节点
2. 选择子节点的代码
3. 右键点击并选择 "New Child Node"
4. 新节点成为当前节点的子节点

#### 父节点
1. 选择一个节点作为未来的子节点
2. 选择父节点的代码
3. 右键点击并选择 "New Parent Node"
4. 如果子节点已有父节点，系统会自动创建树分叉
5. 原有关系保留，新关系形成独立分支

#### 兄弟节点
1. 确保已选择当前节点
2. 选择兄弟节点的代码
3. 右键点击并选择 "Mark as Bro Node"
4. 如果当前节点有父节点，新节点成为同一父节点的子节点
5. 如果当前节点是根节点，新节点成为新的根节点

### 节点操作

#### 复制和粘贴节点
1. **复制节点**: 选择一个节点，右键预览界面选择"复制"或使用命令面板
   - 复制节点及其所有子节点到剪贴板
   - 保持原节点不变
2. **剪切节点**: 选择一个节点，右键预览界面选择"剪切"或使用命令面板
   - 移动节点及其所有子节点到剪贴板
   - 原节点将被删除
3. **粘贴节点**: 在目标位置右键预览界面选择"粘贴"或使用命令面板
   - 在当前节点下创建复制的节点结构
   - 自动生成新的节点 ID 避免冲突

#### 调整节点顺序
1. **上移节点**: 选择一个节点，右键预览界面选择"上移"或使用命令面板
   - 将节点在同级中向上移动一个位置
   - 如果已在最上方，显示提示信息
2. **下移节点**: 选择一个节点，右键预览界面选择"下移"或使用命令面板
   - 将节点在同级中向下移动一个位置
   - 如果已在最下方，显示提示信息
3. **自动更新**: 移动完成后预览界面自动刷新显示新顺序

### 编辑节点

#### 编辑节点信息
1. 点击节点导航到代码位置
2. 在预览面板点击 "Edit Node" 按钮
3. 修改节点名称、文件路径、行号、代码片段或描述
4. 点击 "保存" 按钮
5. 系统自动验证位置并更新预览

#### 添加描述
1. 编辑节点时在描述框输入文本
2. 支持多行描述
3. 描述会以灰色斜体显示在预览中
4. 描述不影响节点功能，仅用于说明

### 智能位置追踪

#### 自动检测位置变化
1. 修改代码后，节点位置可能发生变化
2. 点击节点时系统自动检测位置
3. 如果检测到变化，显示警告提示：
   ```
   ⚠️ Code location may have changed: Code found at line 124 (moved 2 lines)
   [OK] [Dismiss]
   ```
4. 点击 "OK" 自动更新节点位置
5. 点击 "Dismiss" 保持原位置

#### 搜索策略
系统使用多层搜索策略找到移动的代码：
1. **精确匹配**: 使用 SHA-256 代码哈希
2. **邻近搜索**: 在原位置 ±20 行范围内搜索
3. **全文搜索**: 搜索整个文件
4. **模糊匹配**: 使用 Levenshtein 距离算法

#### 置信度级别
- **exact**: 精确匹配（哈希相同）
- **high**: 高置信度（相似度>95%或距离≤5行）
- **medium**: 中等置信度（相似度>85%或距离≤10行）
- **low**: 低置信度（相似度>80%）

### 树分叉功能

#### 创建分叉
1. 选择一个已有父节点的节点
2. 为其创建新的父节点
3. 系统自动创建分叉：
   - 原节点保留在原分支
   - 创建节点副本到新分支
   - 所有子孙节点转移到新分支

#### 使用场景
- 追踪同一函数的不同调用路径
- 探索不同的执行场景
- 记录多种可能的代码流程

### 兄弟节点功能

#### 什么是兄弟节点
兄弟节点是指与当前节点处于同一层级、共享相同父节点的节点。这个功能帮助开发者追踪同一父函数调用的多个平行分支。

#### 创建兄弟节点
1. **选择当前节点**: 确保已有一个当前节点
2. **选择代码**: 在编辑器中选择要创建兄弟节点的代码
3. **创建节点**: 使用以下任一方式：
   - 右键菜单 → "New Bro Node"
   - 快捷键 `Ctrl+Alt+B`
   - 命令面板 (`Ctrl+Shift+P`) → "CodePath: New Bro Node"

#### 兄弟节点行为
- **有父节点时**: 新节点成为当前节点父节点的子节点
- **根节点时**: 新节点成为新的根节点
- **自动命名**: 使用选中文本的前50个字符作为节点名称
- **关系保持**: 不影响其他现有节点的关系

#### 使用示例
```
原始结构:
parent
└── currentNode

创建兄弟节点后:
parent
├── currentNode
└── broNode (新创建的兄弟节点)

根节点情况:
rootNode1 (当前节点)

创建兄弟节点后:
rootNode1 (当前节点)
rootNode2 (新的兄弟根节点)
```

### 导航

#### 模糊名称匹配
- 使用 "Switch Current Node" 命令
- 输入部分节点名称（例如 "validate" 匹配 "validateUserInput"）
- 从过滤列表中选择

#### 位置匹配
- 使用格式: `filename:line` (例如 `/src/auth.ts:15`)
- 精确文件路径和行号匹配
- 用于跳转到特定代码位置

### CodePath 管理

#### 创建 CodePath
1. 点击状态栏 CodePath 图标 → "新建 CodePath"
2. 或使用命令面板 (`Ctrl+Shift+P`) → "CodePath: Create New CodePath"
3. 输入描述性名称（可选，留空使用默认名称）
4. 系统自动切换到新 CodePath 并更新预览
5. 开始向新 CodePath 添加节点

#### 切换 CodePath
1. 点击状态栏 CodePath 图标 → "切换 CodePath"
2. 或使用快捷键 `Ctrl+Shift+G`
3. 从可用 CodePath 列表中选择
4. 预览自动更新显示新图表

#### 导出 CodePath
**方式 1: 状态栏菜单**
1. 点击状态栏 CodePath 图标 → "导出 CodePath"
2. 选择保存位置
3. 生成 Markdown 文件

**方式 2: 预览面板**
1. 在预览面板点击 "📤 Export" 按钮
2. 选择保存位置
3. 生成 Markdown 文件

**方式 3: 文件浏览器**
1. 在文件浏览器找到 `.codepath/*.json` 文件
2. 右键 → "分享 CodePath"
3. Windows/macOS: 文件复制到剪贴板，可直接粘贴
4. Linux: 文件路径复制到剪贴板

#### 导入 CodePath
1. 点击状态栏 CodePath 图标 → "导入 CodePath"
2. 或使用命令面板 → "CodePath: Import CodePath"
3. 选择要导入的 .md 文件
4. 系统自动：
   - 导入图表数据
   - 切换到新图表
   - 打开预览面板
   - 如果有当前节点，自动导航到该位置

#### 预览 CodePath 文件
1. 在文件浏览器找到 `.codepath/*.json` 文件
2. 右键 → "预览 CodePath"
3. 系统自动切换到该图表并打开预览

#### 删除 CodePath
1. 点击状态栏 CodePath 图标 → "删除 CodePath"
2. 从列表中选择要删除的图表
3. 确认删除操作
4. 图表文件被永久删除

### 预览界面自定义菜单

#### 右键菜单功能
在预览界面中右键点击节点可以访问自定义菜单：

1. **刷新**: 重新加载预览内容，重新验证所有节点位置
2. **导出**: 导出当前图表为 Markdown 文件
3. **复制**: 复制选中节点及其所有子节点
4. **粘贴**: 粘贴剪贴板中的节点到当前位置
5. **剪切**: 剪切选中节点及其所有子节点
6. **上移**: 将节点在同级中向上移动
7. **下移**: 将节点在同级中向下移动

#### 菜单显示逻辑
- 所有用户都可以看到"刷新"和"导出"选项
- 只有选中节点时才显示"复制"、"剪切"、"上移"、"下移"选项
- 只有剪贴板中有数据时才显示"粘贴"选项
- 菜单操作针对当前选中的节点执行

### 预览格式

#### 文本视图
```
📁 我的代码路径图表 (4 个节点)
├── 🔵 validateInput (auth.ts:15) [当前]
│   │   <描述信息以灰色斜体显示>
│   └── 🔵 checkPermissions (auth.ts:25)
├── 🔵 validateToken (auth.ts:30)
└── ⚠️ processRequest (api.ts:10)
    │   <位置可能已变化>
```

**显示特性**:
- 简化文件名显示（只显示文件名，不显示完整路径）
- 当前节点标记 `[当前]`
- 位置警告标记 `⚠️`
- 描述信息以灰色斜体显示
- 支持多行描述

#### Mermaid 图表视图
```mermaid
graph TD
    A[validateInput] --> B[checkPermissions]
    C[validateToken]
    D[processRequest]
    
    classDef current fill:#e1f5fe
    classDef warning stroke:#ff9800,stroke-width:3px
    class A current
    class D warning
```

**显示特性**:
- 当前节点高亮显示（浅蓝色背景）
- 警告节点橙色边框
- 清晰的节点关系箭头
- 自动布局优化

## 🔧 高级功能

### 自动保存配置
- 默认每 5 分钟自动保存图表
- 在设置中配置间隔: `codepath.previewRefreshInterval`
- 禁用: `"codepath.autoSave": false`

### 性能优化
- 推荐限制: 每个图表 100 个节点
- 大图表使用分段加载
- 预览渲染有 5 秒超时
- 自动监控内存使用

### 错误恢复
- 每 5 分钟自动备份
- 从备份恢复损坏文件
- 优雅处理缺失文件
- 带有恢复建议的用户友好错误消息

### 工作区集成
- 图表存储在 `.codepath/` 目录
- 自动工作区检测
- 跨平台文件路径处理
- Git 友好的存储格式

### 智能代码追踪
- **代码指纹**: 使用 SHA-256 哈希生成代码指纹
- **多策略搜索**: 精确匹配 → 邻近搜索 → 全文搜索 → 模糊匹配
- **置信度评估**: 根据匹配质量提供不同级别的置信度
- **自动更新**: 用户确认后自动更新节点位置和代码片段
- **即时刷新**: 更新后预览立即刷新，无需手动操作

### 树分叉管理
- **自动检测**: 系统自动检测是否需要创建分叉
- **关系保留**: 原有父子关系完整保留
- **子树转移**: 所有子孙节点自动转移到新分支
- **独立管理**: 分叉后的节点可以独立编辑和管理

### 文件浏览器集成
- **快速预览**: 右键 JSON 文件直接预览图表
- **一键分享**: 复制文件到剪贴板（Windows/macOS）
- **路径分享**: 复制文件路径（Linux）
- **自动切换**: 预览时自动切换到对应图表

### 节点编辑和验证
- **实时编辑**: 在预览面板直接编辑节点信息
- **自动验证**: 保存后自动验证位置是否正确
- **即时反馈**: 验证结果立即显示在预览中
- **警告管理**: 自动添加或清除位置警告标记

## 🐛 故障排除

### 常见问题

#### "请先选择代码文本"
- **原因**: 创建节点时没有选择文本
- **解决方案**: 右键点击前先高亮代码

#### "没有选择当前节点"
- **原因**: 尝试创建子/父/兄弟节点但没有当前节点
- **解决方案**: 先切换到一个节点或创建根节点

#### 预览不更新
- **原因**: 预览刷新间隔太高或渲染错误
- **解决方案**: 使用 `Ctrl+Shift+R` 强制刷新或检查错误消息

#### 启动时 CodePath 不加载
- **原因**: 自动加载被禁用或 CodePath 文件损坏
- **解决方案**: 在设置中启用自动加载或手动切换 CodePath

#### 节点显示 ⚠️ 警告
- **原因**: 代码位置发生变化，系统检测到不匹配
- **解决方案**: 
  1. 点击节点，系统会尝试导航到原位置
  2. 点击 "Edit Node" 按钮修改位置信息
  3. 或点击节点时选择 "OK" 自动更新位置

#### 编辑节点后警告不消失
- **原因**: 修改的位置信息仍然不正确
- **解决方案**: 
  1. 确保修改的行号和代码片段与实际代码匹配
  2. 检查文件路径是否正确
  3. 保存后系统会自动重新验证

#### 导入后无法导航到节点
- **原因**: 导入的图表中的文件路径在本地不存在
- **解决方案**: 
  1. 检查文件是否存在于工作区
  2. 使用 "Edit Node" 修改文件路径
  3. 或重新创建节点指向正确的文件

#### 树分叉后节点重复
- **原因**: 这是正常行为，用于追踪多条执行路径
- **说明**: 
  - 原节点保留在原分支
  - 副本节点在新分支
  - 两个节点独立管理，可以有不同的子节点

#### 兄弟节点创建失败
- **原因**: 没有当前节点或没有选择代码文本
- **解决方案**: 
  1. 确保已选择一个当前节点
  2. 在编辑器中选择要创建节点的代码文本
  3. 检查是否有活动的 Code Path 图表

#### 兄弟节点关系不正确
- **原因**: 对兄弟节点概念理解有误
- **说明**: 
  - 兄弟节点与当前节点共享相同的父节点
  - 如果当前节点是根节点，新兄弟节点也是根节点
  - 兄弟节点不会影响现有的父子关系

#### "Mark as Bro Node" 菜单项不显示
- **原因**: 不满足显示条件
- **解决方案**: 
  1. 确保已选择当前节点（状态栏显示节点信息）
  2. 确保在编辑器中选择了代码文本
  3. 确保有活动的 Code Path 图表
  4. 检查上下文菜单的 "Code Path" 子菜单

#### 复制粘贴功能不工作
- **原因**: 没有选择节点或剪贴板为空
- **解决方案**: 
  1. 确保已选择要复制的节点
  2. 复制后确认状态栏或通知显示成功消息
  3. 粘贴前确保剪贴板中有节点数据
  4. 检查是否有足够的权限进行操作

#### 节点移动功能无效
- **原因**: 节点已在边界位置或没有兄弟节点
- **解决方案**: 
  1. 确认节点不是唯一的子节点
  2. 上移时确认不是第一个子节点
  3. 下移时确认不是最后一个子节点
  4. 检查节点是否有父节点或是根节点

#### 预览界面右键菜单不显示
- **原因**: 浏览器安全限制或脚本加载失败
- **解决方案**: 
  1. 刷新预览面板
  2. 重新加载 VS Code 窗口
  3. 检查是否有 JavaScript 错误
  4. 使用命令面板作为替代方案

### 性能问题

#### 预览更新缓慢
- **原因**: 图表太大或复杂的 Mermaid 图表
- **解决方案**: 减少节点数量或切换到文本视图

#### 内存使用过高
- **原因**: 加载了多个大图表
- **解决方案**: 关闭未使用的图表或重启 VS Code

### 文件系统问题

#### 权限被拒绝错误
- **原因**: 文件系统权限不足
- **解决方案**: 检查工作区权限或以管理员身份运行 VS Code

#### 找不到工作区
- **原因**: VS Code 中没有打开文件夹/工作区
- **解决方案**: 使用 CodePath 前先打开文件夹或工作区

## 🌟 新功能亮点

### 智能位置追踪 (v0.1.0+)

当你重构代码或移动函数时，CodePath 会自动检测位置变化：

**工作流程**:
1. 修改代码，移动函数位置
2. 点击节点时系统自动检测
3. 显示提示：`⚠️ Code location may have changed: Code found at line 124 (moved 2 lines)`
4. 点击 "OK" 自动更新节点位置
5. 预览立即刷新，警告消失

**技术特性**:
- SHA-256 代码指纹技术
- 4 层搜索策略（精确 → 邻近 → 全文 → 模糊）
- 4 级置信度评估（exact, high, medium, low）
- 即时预览更新

### 树分叉功能 (v0.1.0+)

追踪同一代码的多条执行路径：

**使用场景**:
```
原始结构:
root → child → grandchild

为 child 添加新父节点 newParent 后:
├─ newParent → child → grandchild  (新分支)
└─ root → child                     (原分支)
```

**特性**:
- 自动检测并创建分叉
- 保留原有关系
- 子树自动转移
- 独立管理分支

### 节点编辑和验证 (v0.1.0+)

实时编辑节点信息，自动验证位置：

**功能**:
- 编辑名称、路径、行号、代码片段
- 添加多行描述（支持斜体格式）
- 保存后自动验证位置
- 即时更新预览和警告状态

**用户体验**:
- 点击节点 → Edit Node → 修改 → 保存 → 自动验证 → 预览更新

### 文件浏览器集成 (v0.1.0+)

直接从文件浏览器管理图表：

**预览功能**:
- 右键 `.codepath/*.json` → "预览 CodePath"
- 自动切换到该图表
- 打开预览面板

**分享功能**:
- 右键 `.codepath/*.json` → "分享 CodePath"
- Windows/macOS: 文件复制到剪贴板
- Linux: 文件路径复制到剪贴板
- 可直接粘贴到聊天工具或文件夹

### 导入自动切换 (v0.1.0+)

导入图表后自动切换和导航：

**工作流程**:
1. 导入 Markdown 文件
2. 自动切换到新图表
3. 打开预览面板
4. 如果有当前节点，自动导航到代码位置

**优势**:
- 无缝导入体验
- 立即可用
- 自动上下文恢复

### 预览面板导出 (v0.1.0+)

直接从预览面板导出图表：

**使用方式**:
- 点击预览面板工具栏的 "📤 Export" 按钮
- 选择保存位置
- 生成 Markdown 文件

**优势**:
- 更快捷的操作
- 无需打开菜单
- 一键导出

### 菜单结构重组 (v0.1.0+)

统一的菜单结构和更直观的命名：

**菜单结构**:
- 所有功能统一到"Code Path"子菜单
- 更直观的命名："Mark as" 替代 "New"
- 支持文件/文件夹上下文操作

**新命名**:
- "Mark as New Node" (原 "New Node")
- "Mark as Child Node" (原 "New Child Node")
- "Mark as Parent Node" (原 "New Parent Node")
- "Mark as Bro Node" (原 "New Bro Node")

### 节点复制粘贴功能 (v0.1.0+)

强大的节点复制和粘贴功能：

**复制功能**:
- 复制节点及其所有子节点
- 保持完整的节点树结构
- 不影响原始节点

**粘贴功能**:
- 在目标位置重建节点树
- 自动生成新的节点 ID
- 支持跨图表粘贴

**剪切功能**:
- 移动节点到新位置
- 删除原始节点
- 保持子节点关系

### 节点顺序管理 (v0.1.0+)

调整节点在同级中的显示顺序：

**上移/下移**:
- 在同级节点中调整位置
- 支持根节点和子节点
- 自动处理边界情况

**智能提示**:
- 边界位置显示友好提示
- 操作完成后自动更新预览

### 预览界面自定义菜单 (v0.1.0+)

预览界面的右键自定义菜单：

**菜单功能**:
- 刷新、导出、复制、粘贴、剪切
- 上移、下移节点
- 条件显示相关选项

**用户体验**:
- 替代默认浏览器菜单
- 针对选中节点的操作
- 快速访问常用功能

### 文件/文件夹上下文支持 (v0.1.0+)

从文件资源管理器直接创建节点：

**支持类型**:
- 任意文件类型
- 文件夹
- 自动路径处理

**智能命名**:
- 使用文件/文件夹名称
- 自动设置正确路径
- 文件夹默认行号为 1

### 创建兄弟节点功能 (v0.1.0+)

快速创建与当前节点同级的兄弟节点：

**使用方式**:
- 选择代码文本
- 右键菜单 → "Code Path" → "Mark as Bro Node"
- 或使用快捷键 `Ctrl+Alt+B`
- 或命令面板 → "Code Path Marker: Mark as Bro Node"

**智能关系处理**:
- 有父节点时：新节点成为父节点的子节点
- 根节点时：新节点成为新的根节点
- 自动代码捕获和节点命名

**使用场景**:
- 追踪同一父函数的多个分支
- 记录平行执行路径
- 快速扩展代码路径图

**使用示例**:
```javascript
// 假设你正在追踪这个函数的执行路径
function processUser(userData) {
    // 1. 首先创建根节点指向这里
    validateUser(userData);  // 2. 创建子节点指向这里
    
    // 3. 现在你想追踪同级的其他验证函数
    validateEmail(userData.email);     // 4. 选择这行，Ctrl+Alt+B 创建兄弟节点
    validatePassword(userData.password); // 5. 选择这行，Ctrl+Alt+B 创建另一个兄弟节点
    
    return processData(userData);
}
```

**结果预览**:
```
📁 用户处理流程 (4 个节点)
├── 🔵 processUser (user.js:1)
│   ├── 🔵 validateUser (user.js:3) [当前]
│   ├── 🔵 validateEmail (user.js:6)
│   └── 🔵 validatePassword (user.js:7)
```

## 🤝 贡献

我们欢迎贡献！请查看我们的 [贡献指南](CONTRIBUTING-ZH.md) 了解详情。

### 开发设置

1. 克隆仓库
2. 运行 `npm install`
3. 在 VS Code 中打开
4. 按 `F5` 启动扩展开发主机
5. 进行更改和测试

### 运行测试

```bash
# 单元测试
npm run test:unit

# 集成测试
npm run test:unit -- src/integration/

# 带覆盖率的所有测试
npm run test:unit -- --coverage
```

## 📄 许可证

本项目基于 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🆘 支持

- **问题**: [GitHub Issues](https://github.com/your-org/codepath-extension/issues)
- **讨论**: [GitHub Discussions](https://github.com/your-org/codepath-extension/discussions)
- **文档**: [Wiki](https://github.com/your-org/codepath-extension/wiki)

## 🎉 致谢

- VS Code 扩展 API 团队提供的优秀文档
- Mermaid.js 提供的图表渲染功能
- 开源社区的灵感和反馈

---

**愉快的代码追踪！ 🚀**

*CodePath 帮助你前所未有地理解代码流程。今天就开始可视化你的执行路径吧！*